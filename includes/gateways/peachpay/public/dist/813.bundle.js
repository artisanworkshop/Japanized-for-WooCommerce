"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[813],{6550:()=>{},4144:(e,t,a)=>{a.r(t),a.d(t,{createVerifyBuyerDetails:()=>B,default:()=>N,handleTokenResult:()=>U,initSquarePaymentProvider:()=>N,squarePaymentRequestOptions:()=>J});var n=a(655),r=a(2121),i=a(9276),o=a(7418),c=a(6673),s=a(7462),l=a(9350),u=a(7629),d=a(9970),p=a(8401),h=a(7059),y=a(4241),f=a(4071),m=a(6204),v=a(1212),g=a(9545);function b(e){h.h.subscribe((function(){!function(e,t,a,n){"square"!==e||"payment"!==t&&"returning"!==t?(0,g.HD)(".square-btn-container",(function(e){e.classList.add("hide")})):(0,g.HD)(".square-btn-container",(function(e){e.classList.remove("hide")}));"finished"===a&&(null==n?void 0:n.hasCustomButton)?(0,g.HD)(".square-custom-btn-container",(function(e){e.classList.remove("hide")})):(0,g.HD)(".square-custom-btn-container",(function(e){e.classList.add("hide")}));"loading"===a||(null==n?void 0:n.hasCustomButton)?(0,g.HD)(".square-btn",(function(e){e.classList.add("hide")})):(0,g.HD)(".square-btn",(function(e){e.classList.remove("hide")}))}(u.hv.selectedProvider(),s.qA.modalUI.page(),s.qA.modalUI.loadingMode(),u.hv.selectedMethodConfiguration()),function(e,t){"loading"===e||"processing"===e&&(null==t?void 0:t.hasCustomButton)?(0,g.HD)(".square-spinner-container",(function(e){e.classList.remove("hide")})):(0,g.HD)(".square-spinner-container",(function(e){e.classList.add("hide")}));"processing"===e?(0,g.HD)(".square-btn-spinner",(function(e){e.classList.remove("hide")})):(0,g.HD)(".square-btn-spinner",(function(e){e.classList.add("hide")}));"processing"===e?(0,g.HD)(".square-btn > .button-text",(function(e){e.innerHTML=(0,f.M)("Processing")})):(0,g.HD)(".square-btn > .button-text",(function(e){e.innerHTML="".concat((0,f.M)("Pay")," ").concat((0,v.o)(c.AQ.total()))}));"finished"===e?(0,g.HD)(".square-btn",(function(e){e.disabled=!1})):(0,g.HD)(".square-btn",(function(e){e.disabled=!0}))}(s.qA.modalUI.loadingMode(),u.hv.selectedMethodConfiguration()),function(e){var t,a,r,i,o;if("square"!==u.hv.selectedProvider())return;var c=Object.entries(e).sort((function(e,t){var a,r,i,o,c,s=(0,n.CR)(e,2),l=(s[0],s[1]),u=(0,n.CR)(t,2);u[0];return(null!==(i=null===(r=null===(a=u[1].state)||void 0===a?void 0:a.mountTarget)||void 0===r?void 0:r.length)&&void 0!==i?i:0)-(null!==(c=null===(o=l.state)||void 0===o?void 0:o.mountTarget.length)&&void 0!==c?c:0)}));try{for(var s=(0,n.XA)(c),l=s.next();!l.done;l=s.next()){var d=(0,n.CR)(l.value,2),p=(d[0],d[1]);p.state||(p.state={mountTarget:""});var h=_();if(p.state.mountTarget&&p.state.mountTarget!==h&&(null===(r=null==p?void 0:p.detach)||void 0===r||r.call(p),p.state.mountTarget=""),u.hv.selectedProviderMethod()===p.config.slug){if(p.state.mountTarget)continue;null===(i=null==p?void 0:p.attach)||void 0===i||i.call(p,h),p.state.mountTarget=h}else{if(!p.state.mountTarget)continue;null===(o=null==p?void 0:p.detach)||void 0===o||o.call(p),p.state.mountTarget=""}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(t)throw t.error}}}(e)}))}function _(){return s.qA.customer.existing()?"#existing-customer-pay-button .square-custom-btn-container":s.qA.customer.mobile()?"#mobile-customer-pay-button .square-custom-btn-container":"#new-customer-pay-button .square-custom-btn-container"}var w=a(3493),q=a(9402),A=a(3176);var k=a(6550),x=a(1924);function L(e,t){var a,n=this;return void 0===t&&(t=300),function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];clearTimeout(a),a=setTimeout((function(){e.apply(n,r)}),t)}}function z(){var e=s.L0.metadata("peachpay_square_afterpay_gateway","title");if(e&&"Afterpay"!==e&&"Clearpay"!==e)return e;switch(d.gx.billing.country()){case"GB":case"ES":case"FR":case"IT":return"Clearpay";default:return"Afterpay"}}const C=a.p+"img/4eb6a57eeeccfe1617eb-cashapp-green.svg",M=a.p+"img/efa03ef0d084294ce629-cashapp-green-logo-only.svg";var S=a(6857),P=a(3041);const I=a.p+"img/d067b36f63345d495b52-apple-pay-button.png";function E(){var e,t,a,r,i=this,o=null,u=((r=document.createElement("div")).innerHTML='<button class="square-apay-btn">\n        <style>\n            .square-apay-btn{\n                background-image: url('.concat(I,");\n                background-color: black;\n                border: none; height: 55px;\n                width: 15rem;\n                background-size: contain;\n                border-radius: 0.2rem;\n                background-position: center;\n            }\n\n            .square-apay-btn:hover{\n                opacity: 0.8;\n            }\n        </style>\n    </button>"),r.querySelector("button")),d={name:null!==(e=s.L0.metadata("peachpay_square_applepay_gateway","title"))&&void 0!==e?e:(0,f.M)("Apple Pay"),slug:"applepay",gateway:"peachpay_square_applepay",description:'\n<img style="display: block; text-align: left; height: 1.5rem; " src="'.concat(P,'">\n<p style="text-align: left; margin: 0.5rem 0;">').concat((0,f.M)("Apple Pay selected for checkout."),'</p>\n<hr/>\n<p style="text-align: left; margin: 0.5rem 0 0;" class="muted">').concat((0,f.M)("Another step will appear after submitting your order to complete your purchase details."),"<p>"),reusable:!0,assets:{badge:{src:S},title:{src:P}},defaultCurrency:s.L0.metadata("peachpay_square_applepay_gateway","default_currency"),currencies:null!==(t=s.L0.metadata("peachpay_square_applepay_gateway","supported_currencies"))&&void 0!==t?t:["ALL"],hasCustomButton:!0},p=L((function(e,t){return(0,n.mG)(i,void 0,void 0,(function(){var a;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(o)return[2];if(0===c.AQ.total()||!d.currencies.includes(l.l9.currency.code()))return d.initialized=!1,h.h.dispatch((0,w.s)()),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.applePay(t)];case 2:return o=n.sent(),d.initialized=!0,h.h.dispatch((0,w.s)()),[3,4];case 3:return a=n.sent(),d.initialized=!1,h.h.dispatch((0,w.s)()),console.error(a),(0,A.W4)(a,{paymentRequest:t}),[3,4];case 4:return[2]}}))}))}));return{config:d,activate:p,reset:function(){var e;clearInterval(a);var t=o;o=null,null===(e=null==t?void 0:t.destroy())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodAlreadyDestroyedError||(console.error(e),(0,A.W4)(e))}))},attach:function(e){clearInterval(a),a=setInterval((function(){o&&(clearInterval(a),(0,g.MW)(e,(function(e){return e.insertAdjacentElement("afterbegin",u)})))}),200)},detach:function(){u.remove()},tokenize:function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t;return(0,n.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),o?[4,o.tokenize()]:[2,[null,null,{paymentStatus:"creationfailed",note:"Failed to find Apple Pay instance while attempting to tokenize the payment."}]];case 1:return[2,U(a.sent())];case 2:return e=a.sent(),t={paymentStatus:"creationfailed",note:"An unknown exception occured while tokenizing the payment."},e instanceof Error&&(t.note=e.message),[2,[null,null,t]];case 3:return[2]}}))}))}}}var D=a(8883),T=a(5792);var H=a(410),R=a(3172);var G=a(3658);function N(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,a,r,o,p,y,m,v=this;return(0,n.Jh)(this,(function(_){switch(_.label){case 0:return t=s.L0.metadata("peachpay_square_gateways","application_id"),a=s.L0.metadata("peachpay_square_gateways","location_id"),r=s.L0.metadata("peachpay_square_gateways","script_src"),t&&a&&r?[4,(0,g.ve)(r,"Square")]:[2];case 1:return _.sent(),window.Square?(o=window.Square.payments(t,a),p=function(){var e,t,a={};if(s.L0.enabled("peachpay_square_card_gateway")){var r=function(){var e,t,a=null,r=null,i=!1;return{config:{name:null!==(e=s.L0.metadata("peachpay_square_card_gateway","title"))&&void 0!==e?e:(0,f.M)("Card"),slug:"card",gateway:"peachpay_square_card",description:"",reusable:!0,assets:{title:{src:T},badge:{src:D}},defaultCurrency:s.L0.metadata("peachpay_square_card_gateway","default_currency"),currencies:null!==(t=s.L0.metadata("peachpay_square_card_gateway","supported_currencies"))&&void 0!==t?t:["ALL"]},activate:function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,o;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return i?[2]:(i=!0,t={style:{".input-container":{borderWidth:"1px"}}},(0,g.HD)('div.pp-pm-saved-option[data-provider="square"][data-method="card"][data-index=""]',(function(e){e.style.padding="0",e.style.border="unset"})),[4,e.card(t)]);case 1:return(a=n.sent()).attach('#pp-pms-new div.pp-pm-saved-option[data-provider="square"][data-method="card"][data-index=""]').catch((function(){})),null==a||a.recalculateSize(),[4,e.card(t)];case 2:return(r=n.sent()).attach('#pp-pms-existing div.pp-pm-saved-option[data-provider="square"][data-method="card"][data-index=""]').catch((function(){})),null==r||r.recalculateSize(),o="",h.h.subscribe((function(){var e=u.hv.selectedPaymentMethod();e!==o&&(o=e,null==a||a.recalculateSize(),null==r||r.recalculateSize())})),[2]}}))}))},tokenize:function(e){var t;return(0,n.mG)(this,void 0,void 0,(function(){var i,o,c,l,u,d,p,h;return(0,n.Jh)(this,(function(y){switch(y.label){case 0:if(!(i=s.qA.customer.existing()?r:a))return[2,[null,null,{paymentStatus:"creationfailed",note:"Square Card element not found while attempting to tokenize card."}]];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,i.tokenize()];case 2:return o=y.sent(),[3,4];case 3:return c=y.sent(),[2,[null,null,{paymentStatus:"creationfailed",note:"Square Card element tokenization failed with error: ".concat(c.message)}]];case 4:if(l=(0,n.CR)(U(o),3),u=l[0],l[1],d=l[2],!u)return[2,[null,null,d]];y.label=5;case 5:return y.trys.push([5,7,,8]),[4,e.verifyBuyer(u,B())];case 6:return p=y.sent(),[2,[u,null!==(t=null==p?void 0:p.token)&&void 0!==t?t:null,{}]];case 7:return h=y.sent(),[2,[null,null,{paymentStatus:"creationfailed",note:"Verifying Square buyer failed with error: ".concat(h.message)}]];case 8:return[2]}}))}))}}}();a.card=r}if(s.L0.enabled("peachpay_square_card_gateway")){var i=function(){var e,t,a,r=this,i=null,o={name:null!==(e=s.L0.metadata("peachpay_square_googlepay_gateway","title"))&&void 0!==e?e:(0,f.M)("Google Pay"),slug:"googlepay",gateway:"peachpay_square_googlepay",description:'\n<img style="display: block; text-align: left; height: 1.5rem; " src="'.concat(R,'">\n<p style="text-align: left; margin: 0.5rem 0;">').concat((0,f.M)("Google Pay selected for checkout."),'</p>\n<hr/>\n<p style="text-align: left; margin: 0.5rem 0 0;" class="muted">').concat((0,f.M)("Another step will appear after submitting your order to complete your purchase details."),"<p>"),reusable:!1,assets:{badge:{src:H},title:{src:R}},defaultCurrency:s.L0.metadata("peachpay_square_googlepay_gateway","default_currency"),currencies:null!==(t=s.L0.metadata("peachpay_square_googlepay_gateway","supported_currencies"))&&void 0!==t?t:["ALL"],hasCustomButton:!0},u=L((function(e,t){return(0,n.mG)(r,void 0,void 0,(function(){var a;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(i)return[2];if(0===c.AQ.total()||!o.currencies.includes(l.l9.currency.code()))return o.initialized=!1,h.h.dispatch((0,w.s)()),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.googlePay(t)];case 2:return i=n.sent(),h.h.dispatch((0,w.s)()),o.initialized=!0,h.h.dispatch((0,w.s)()),[3,4];case 3:return a=n.sent(),o.initialized=!1,h.h.dispatch((0,w.s)()),console.error(a),(0,A.W4)(a,{paymentRequest:t}),[3,4];case 4:return[2]}}))}))}));return{config:o,activate:u,reset:function(){clearInterval(a);var e=i;i=null,null==e||e.destroy().catch((function(e){e instanceof k.PaymentMethodAlreadyDestroyedError||(console.error(e),(0,A.W4)(e))}))},attach:function(e){clearInterval(a),a=setInterval((function(){var t;i&&(clearInterval(a),null===(t=null==i?void 0:i.attach(e,{buttonColor:"black",buttonSizeMode:"fill"}))||void 0===t||t.catch((function(t){o.initialized=!1,h.h.dispatch((0,w.s)()),t instanceof k.PaymentMethodUnsupportedError?console.log(t):(console.error(t),(0,A.W4)(t,{selector:e}))})))}),200)},detach:function(){var e;clearInterval(a),null===(e=null==i?void 0:i.detach())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodNotAttachedError||(o.initialized=!1,h.h.dispatch((0,w.s)()),e instanceof k.PaymentMethodAlreadyDestroyedError?i=null:(console.error(e),(0,A.W4)(e)))}))},tokenize:function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t;return(0,n.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),i?[4,i.tokenize()]:[2,[null,null,{paymentStatus:"creationfailed",note:"Failed to find Google Pay instance while attempting to tokenize the payment."}]];case 1:return[2,U(a.sent())];case 2:return e=a.sent(),t={paymentStatus:"creationfailed",note:"An unknown exception occured while tokenizing the payment."},e instanceof Error&&(t.note=e.message),[2,[null,null,t]];case 3:return[2]}}))}))}}}();a.googlepay=i}if(s.L0.enabled("peachpay_square_applepay_gateway")){var o=E();a.applepay=o}if(s.L0.enabled("peachpay_square_ach_gateway")){var p=function(){var e,t,a=null,r=!1,i={name:null!==(e=s.L0.metadata("peachpay_square_ach_gateway","title"))&&void 0!==e?e:(0,f.M)("US Bank Account"),slug:"us_bank_account",gateway:"peachpay_square_ach",description:'\n\t<p style="margin: 0;">\n\t\t'.concat((0,f.M)("After selecting <b>Pay</b> a prompt will appear to select a bank account."),'\n\t</p>\n\t<hr>\n\t<p class="muted" style="margin: 0;">\n\t\t').concat((0,f.M)("Note: Payments may take up to 5 days to complete."),"\n\t</p>\n\t"),reusable:!1,assets:{badge:{src:q},title:{src:q}},defaultCurrency:s.L0.metadata("peachpay_square_ach_gateway","default_currency"),currencies:null!==(t=s.L0.metadata("peachpay_square_ach_gateway","supported_currencies"))&&void 0!==t?t:["ALL"]};return{config:i,activate:function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(r)return[2];r=!0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.ach({redirectURI:window.location.href,transactionId:"0"})];case 2:return(a=n.sent()).addEventListener("ontokenization",(function(e){})),i.initialized=!0,h.h.dispatch((0,w.s)()),[3,4];case 3:return t=n.sent(),i.initialized=!1,h.h.dispatch((0,w.s)()),console.error(t),(0,A.W4)(t),[3,4];case 4:return[2]}}))}))},tokenize:function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),a?[4,a.tokenize({accountHolderName:d.gx.billing.fullName()})]:[2,[null,null,{paymentStatus:"creationfailed",note:"Failed to find ACH Bank instance while attempting to tokenize the payment."}]];case 1:return[2,U(n.sent())];case 2:return e=n.sent(),t={paymentStatus:"creationfailed",note:"An unknown exception occured while tokenizing the payment."},e instanceof Error&&(t.note=e.message),[2,[null,null,t]];case 3:return[2]}}))}))}}}();a.ach=p}if(s.L0.enabled("peachpay_square_afterpay_gateway")){var y=function(){var e,t,a,r=this,i=null,o={name:z(),slug:"afterpay",gateway:"peachpay_square_afterpay",description:(a=z(),'\n<img style="display: block; text-align: left; height: 1.5rem; " src='.concat(x,'>\n<p style="text-align: left; margin: 0.5rem 0;">').concat(a," ").concat((0,f.M)("selected for checkout."),'</p>\n<hr/>\n<p style="text-align: left; margin: 0.5rem 0 0;" class="muted">').concat((0,f.M)("Another step will appear after submitting your order to complete your purchase details."),"<p>")),reusable:!1,assets:{title:{src:x},badge:{src:x}},defaultCurrency:s.L0.metadata("peachpay_square_afterpay_gateway","default_currency"),currencies:null!==(e=s.L0.metadata("peachpay_square_afterpay_gateway","supported_currencies"))&&void 0!==e?e:["ALL"],hasCustomButton:!0};h.h.subscribe((function(){o.name=z(),(0,g.HD)('.pp-pm-type[data-method="afterpay"][data-provider="square"]',(function(e){var t=e.querySelector("span");t&&(t.innerText=o.name)}))}));var u=L((function(e,t){return(0,n.mG)(r,void 0,void 0,(function(){var a;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(i)return[2];if(0===Number.parseFloat(String(c.AQ.total()))||!o.currencies.includes(l.l9.currency.code()))return o.initialized=!1,h.h.dispatch((0,w.s)()),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.afterpayClearpay(t)];case 2:return i=n.sent(),o.initialized=!0,h.h.dispatch((0,w.s)()),[3,4];case 3:return a=n.sent(),o.initialized=!1,h.h.dispatch((0,w.s)()),console.error("Square Afterpay/Clearpay activation error:"),console.error(a),(0,A.W4)(a),[3,4];case 4:return[2]}}))}))}));return{config:o,activate:u,reset:function(){var e;clearInterval(t);var a=i;i=null,null===(e=null==a?void 0:a.destroy())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodAlreadyDestroyedError||(console.error(e),(0,A.W4)(e))}))},attach:function(e){clearInterval(t),t=setInterval((function(){var a;i&&(clearInterval(t),null===(a=i.attach(e,{buttonColor:"black",buttonType:"checkout_with_afterpay",finalCtaButtonType:"buy_now"}))||void 0===a||a.catch((function(t){o.initialized=!1,h.h.dispatch((0,w.s)()),t instanceof k.PaymentMethodUnsupportedError?console.log(t):(console.error(t),(0,A.W4)(t,{selector:e}))})))}),200)},detach:function(){var e;clearInterval(t),null===(e=null==i?void 0:i.detach())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodNotAttachedError||(o.initialized=!1,h.h.dispatch((0,w.s)()),e instanceof k.PaymentMethodAlreadyDestroyedError?i=null:(console.error(e),(0,A.W4)(e)))}))},tokenize:function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t;return(0,n.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),i?[4,i.tokenize()]:[2,[null,null,{paymentStatus:"creationfailed",note:"Failure processing Afterpay/Clearpay payment."}]];case 1:return[2,U(a.sent())];case 2:return e=a.sent(),t={paymentStatus:"creationfailed",note:"An unknown exception occured while tokenizing the payment."},e instanceof Error&&(t.note=e.message),[2,[null,null,t]];case 3:return[2]}}))}))}}}();a.afterpay=y}if(s.L0.enabled("peachpay_square_cashapp_gateway")){var m=function(){var e,t,a,r=this,i=null,o=null,u=null,d={name:null!==(e=s.L0.metadata("peachpay_square_cashapp_gateway","title"))&&void 0!==e?e:(0,f.M)("Cash App"),slug:"cashapp",gateway:"peachpay_square_cashapp",description:'\n<img style="display: block; text-align: left; height: 1.5rem; " src='.concat(C,'>\n<p style="text-align: left; margin: 0.5rem 0;">').concat((0,f.M)("Cash App selected for checkout."),'</p>\n<hr/>\n<p style="text-align: left; margin: 0.5rem 0 0;" class="muted">').concat((0,f.M)("After pressing the Cash App button you'll be prompted to scan a QR code or approve the payment through the Cash App mobile app."),"<p>"),reusable:!1,assets:{title:{src:C},badge:{src:M}},defaultCurrency:s.L0.metadata("peachpay_square_cashapp_gateway","default_currency"),currencies:null!==(t=s.L0.metadata("peachpay_square_cashapp_gateway","supported_currencies"))&&void 0!==t?t:["ALL"],hasCustomButton:!0},p=L((function(e,t){return(0,n.mG)(r,void 0,void 0,(function(){var a,r,s;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(i)return[2];if(0===Number.parseFloat(String(c.AQ.total()))||!d.currencies.includes(l.l9.currency.code()))return d.initialized=!1,h.h.dispatch((0,w.s)()),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.cashAppPay(t,{redirectURL:null!==(s=null===(r=window.top)||void 0===r?void 0:r.location.href)&&void 0!==s?s:""})];case 2:return(i=n.sent()).addEventListener("ontokenization",(function(e){var t=e.detail;t.tokenResult&&o?o(t.tokenResult):u&&u("An unknown tokenization error occured")})),i.addEventListener("customerDismissed",(function(e){u&&u("Customer closed cashapp popup")})),d.initialized=!0,h.h.dispatch((0,w.s)()),[3,4];case 3:return a=n.sent(),d.initialized=!1,h.h.dispatch((0,w.s)()),console.error(a),(0,A.W4)(a),[3,4];case 4:return[2]}}))}))}));return{config:d,activate:p,reset:function(){var e;if(clearInterval(a),i){var t=i;i=null,o=null,u=null,null===(e=null==t?void 0:t.destroy())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodAlreadyDestroyedError||(console.error(e),(0,A.W4)(e))}))}},attach:function(e){clearInterval(a),a=setInterval((function(){var t;i&&(clearInterval(a),null===(t=null==i?void 0:i.attach(e,{shape:"semiround",size:"medium"}))||void 0===t||t.catch((function(t){d.initialized=!1,h.h.dispatch((0,w.s)()),t instanceof k.PaymentMethodUnsupportedError?console.log(t):(console.error(t),(0,A.W4)(t,{selector:e}))})))}),200)},detach:function(){var e;clearInterval(a),null===(e=null==i?void 0:i.detach())||void 0===e||e.catch((function(e){e instanceof k.PaymentMethodNotAttachedError||(d.initialized=!1,h.h.dispatch((0,w.s)()),e instanceof k.PaymentMethodAlreadyDestroyedError?i=null:(console.error(e),(0,A.W4)(e)))}))},tokenize:function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,a,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),i?(e=new Promise((function(e,t){o=e,u=t})),t=U,[4,e]):[2,[null,null,{paymentStatus:"creationfailed",note:"Failed to find Cash App instance while attempting to tokenize the payment."}]];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:return a=n.sent(),r={paymentStatus:"creationfailed",note:"An unknown exception occured while tokenizing the payment."},a instanceof Error&&(r.note=a.message),[2,[null,null,r]];case 3:return[2]}}))}))}}}();a.cashapp=m}var v={methods:{}};try{for(var b=(0,n.XA)(Object.entries(a)),_=b.next();!_.done;_=b.next()){var S=(0,n.CR)(_.value,2),P=S[0],I=S[1];v.methods[P]=I.config}}catch(t){e={error:t}}finally{try{_&&!_.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return h.h.dispatch((0,u.DK)({square:v})),a}(),b(p),y=function(t){return(0,n.mG)(v,void 0,void 0,(function(){var a,r,c,s;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return(0,i.N6)()?(a=t.target,((null==a?void 0:a.closest("button"))||(null===(s=null===(c=null==a?void 0:a.closest("div"))||void 0===c?void 0:c.shadowRoot)||void 0===s?void 0:s.querySelector("button")))&&(r=p[u.hv.selectedProviderMethod()])&&"square"===u.hv.selectedProvider()?[4,W(o,r,e)]:[2]):[2];case 1:return n.sent(),[2]}}))}))},(0,g.HD)(".square-btn",(function(e){e.addEventListener("click",y)})),(0,g.HD)(".square-custom-btn-container",(function(e){e.addEventListener("click",y)})),m="",h.h.subscribe((function(){var e,t,a,r=J(),i=JSON.stringify(r);if(m!==i&&"finished"===s.qA.modalUI.loadingMode()){m=i;try{for(var c=(0,n.XA)(Object.entries(p)),l=c.next();!l.done;l=c.next()){var u=(0,n.CR)(l.value,2),d=(u[0],u[1]);null===(a=null==d?void 0:d.reset)||void 0===a||a.call(d),d.state=void 0,d.activate(o,o.paymentRequest(r))}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}}})),[2]):[2]}}))}))}function W(e,t,a){return(0,n.mG)(this,void 0,void 0,(function(){var i,c,l,y,f,v,g,b,_,w;return(0,n.Jh)(this,(function(q){switch(q.label){case 0:return i="peachpay_square_cashapp"===t.config.gateway,"peachpay_square_cashapp"!==t.config.gateway&&h.h.dispatch((0,s.N5)()),[4,t.tokenize(e)];case 1:return c=n.CR.apply(void 0,[q.sent(),3]),l=c[0],y=c[1],f=c[2],i&&h.h.dispatch((0,s.N5)()),[4,a.startTransaction(t.config.gateway)];case 2:return v=q.sent(),l&&v?[3,4]:((0,G.j1)(f.note),[4,null==v?void 0:v.complete(f)]);case 3:return q.sent(),h.h.dispatch((0,s.tv)()),[2];case 4:return g={peachpay_session_id:p.Z5.sessionId(),peachpay_transaction_id:v.getId(),peachpay_square_source_id:l},y&&(g.peachpay_square_verification_id=y),[4,a.placeOrder(v,g)];case 5:return"failure"!==(b=q.sent()).result?[3,7]:[4,null==v?void 0:v.complete()];case 6:return q.sent(),h.h.dispatch((0,s.tv)()),[2];case 7:h.h.dispatch((0,d.ud)({provider:u.hv.selectedProvider(),method:u.hv.selectedProviderMethod()})),q.label=8;case 8:return q.trys.push([8,10,,12]),[4,(0,o.ll)()];case 9:return q.sent(),[3,12];case 10:return _=q.sent(),console.error(_),[4,v.complete({note:"Failed to update customer in browser :: ".concat((0,r.H)(_))})];case 11:return q.sent(),[3,12];case 12:return(0,m.c)(),w=a.getOrderRedirect(b),window.top?[4,v.complete()]:[3,14];case 13:q.sent(),window.top.location=w,q.label=14;case 14:return[2]}}))}))}function J(){var e,t;return{countryCode:null!==(t=null===(e=l.l9.general.wcLocationInfoData())||void 0===e?void 0:e.store_country)&&void 0!==t?t:"US",currencyCode:l.l9.currency.code(),lineItems:F(),discounts:Q(),taxLineItems:[{label:(0,f.M)("Tax"),amount:c.AQ.totalTax().toFixed(2)}],total:{label:(0,f.M)("Total"),amount:c.AQ.total().toFixed(2)}}}function F(){var e,t,a,r=new Array;try{for(var i=(0,n.XA)(c.AQ.contents()),o=i.next();!o.done;o=i.next()){var s=o.value;r.push({label:s.name+" Ã— "+(0,y.Qw)(s),amount:(Number.parseFloat(null!==(a=s.display_price)&&void 0!==a?a:s.price)*(0,y.Qw)(s)).toFixed(2)})}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}function Q(){var e,t,a=new Array;try{for(var r=(0,n.XA)(Object.entries(c.AQ.couponRecord())),i=r.next();!i.done;i=r.next()){var o=(0,n.CR)(i.value,2),s=o[0],l=o[1];l&&a.push({id:s,amount:l.toFixed(2),label:s})}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return a}function B(){var e={addressLines:[d.gx.billing.address1(),d.gx.billing.address2()],city:d.gx.billing.city(),countryCode:d.gx.billing.country(),email:d.gx.billing.email(),familyName:d.gx.billing.lastName(),givenName:d.gx.billing.firstName(),phone:d.gx.billing.phone(),state:d.gx.billing.state(),postalCode:d.gx.billing.postal()};return c.AQ.total()>0?{intent:"CHARGE",currencyCode:l.l9.currency.code(),amount:String(c.AQ.total()),billingContact:e}:{intent:"STORE",billingContact:e}}function U(e){var t=function(){var t="";return e.errors&&Array.isArray(e.errors)&&e.errors.forEach((function(e){t+=e.message+". "})),t};switch(e.status){case"OK":return[e.token,null,{}];case"Cancel":return[null,null,{note:"Customer canceled the Payment. "+t(),paymentStatus:"canceled"}];case"Abort":return[null,null,{note:"Tokenizing the payment method was aborted. "+t(),paymentStatus:"creationfailed"}];case"Error":return[null,null,{note:"Tokenizing the payment method encountered an error. "+t(),paymentStatus:"creationfailed"}];case"Invalid":return[null,null,{note:t(),paymentStatus:"creationfailed"}];default:return[null,null,{note:"Tokenizing the payment method encountered an unknown status. "+t(),paymentStatus:"creationfailed"}]}}},6857:(e,t,a)=>{e.exports=a.p+"img/d0db1eb027413f38ddb3-apple-pay.svg"},8883:(e,t,a)=>{e.exports=a.p+"img/d2a66f3e82ab3efab425-card.svg"},410:(e,t,a)=>{e.exports=a.p+"img/7aba4ceea17fbd040a20-google-pay.svg"},1924:(e,t,a)=>{e.exports=a.p+"img/070ee8f2835a668d3bed-afterpay.svg"},3041:(e,t,a)=>{e.exports=a.p+"img/0a580c7c9daca59b189c-apple-pay.svg"},9402:(e,t,a)=>{e.exports=a.p+"img/e7542fee9125d1af4d23-bank.svg"},5792:(e,t,a)=>{e.exports=a.p+"img/b2c8b12eb49165de87d5-credit-card-regular.svg"},3172:(e,t,a)=>{e.exports=a.p+"img/b6a9922efb467e7f87c3-google-pay.svg"}}]);