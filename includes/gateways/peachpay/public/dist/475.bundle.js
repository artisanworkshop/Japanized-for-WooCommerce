"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[475],{2475:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var a=n(655),r=n(7462),i=n(7059),o=n(2121),c=n(3658),s=n(4071),u=n(8883),d=n(5792);var l=n(7629),p=n(9545),h=n(6673),f=n(1212);function y(){i.h.subscribe((function(){!function(e,t,n,a){"authnet"===e&&("payment"===t||"returning"===t)&&a>0?(0,p.HD)(".authnet-btn",(function(e){e.classList.remove("hide")})):(0,p.HD)(".authnet-btn",(function(e){e.classList.add("hide")}));"authnet"===e&&("payment"===t||"returning"===t)&&"loading"!==n&&a>0?(0,p.HD)(".authnet-btn",(function(e){e.classList.remove("hide")})):(0,p.HD)(".authnet-btn",(function(e){e.classList.add("hide")}))}(l.hv.selectedProvider(),r.qA.modalUI.page(),r.qA.modalUI.loadingMode(),h.AQ.total()),function(e,t){if("authnet"!==e)return;"finished"===t?(0,p.HD)(".authnet-btn",(function(e){e.disabled=!1})):(0,p.HD)(".authnet-btn",(function(e){e.disabled=!0}));"loading"===t?(0,p.HD)(".pp-btn-spinner-container",(function(e){e.classList.remove("hide")})):(0,p.HD)(".pp-btn-spinner-container ",(function(e){e.classList.add("hide")}));"processing"===t?((0,p.HD)(".authnet-btn > .button-text",(function(e){e.innerHTML=(0,s.M)("Processing")})),(0,p.HD)(".modal-lock-icon",(function(e){e.classList.add("hide")})),(0,p.HD)(".authnet-btn-spinner",(function(e){e.classList.remove("hide")}))):((0,p.HD)(".authnet-btn > .button-text",(function(e){e.innerHTML="".concat((0,s.M)("Pay")," ").concat((0,f.o)(h.AQ.total()))})),(0,p.HD)(".authnet-btn-spinner",(function(e){e.classList.add("hide")})))}(l.hv.selectedProvider(),r.qA.modalUI.loadingMode())}))}var v=n(8401),m=n(6204),b=n(7418),g=n(9970),_=n(9402);var w=function(){function e(e){this.loginId=e.loginId,this.clientKey=e.clientKey,this.scriptSrc=e.acceptSrc,this.$script=null,this.$button=null}return e.prototype.tokenize=function(t){return(0,a.mG)(this,void 0,void 0,(function(){var n=this;return(0,a.Jh)(this,(function(r){switch(r.label){case 0:if(e.isTokenizing)throw new Error("Tokenization is already in progress. Only 1 tokenization attempt may occur at a time.");return e.isTokenizing=!0,[4,this.mount(t)];case 1:return r.sent(),[4,new Promise((function(e){setTimeout((function(){e()}),1e3)}))];case 2:return r.sent(),[2,new Promise((function(t,r){var i,o;n.$button||r(new Error("Failed to locate Authorize.net tokenize button")),window.peachpayAuthnetResponseHandler=function(n){"Ok"===n.messages.resultCode&&n.opaqueData?t({token:{descriptor:n.opaqueData.dataDescriptor,value:n.opaqueData.dataValue}}):"Error"===n.messages.resultCode?t({error:n.messages.message.map((function(e){return{code:e.code,message:e.text}}))}):r(new Error("Unhandled Authorize.net tokenization response.")),window.peachpayAuthnetResponseHandler=void 0,e.isTokenizing=!1},null===(i=n.$button)||void 0===i||i.click();var c=(0,p.MW)("#AcceptUIContainer"),s=null===(o=(0,p.MW)("#AcceptUIContainer"))||void 0===o?void 0:o.parentNode,u=new MutationObserver((function(n){var r,i;try{for(var o=(0,a.XA)(n),s=o.next();!s.done;s=o.next()){var d=s.value;"childList"===d.type&&d.removedNodes[0]===c&&(u.disconnect(),t({cancel:!0}),window.peachpayAuthnetResponseHandler=void 0,e.isTokenizing=!1)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}));s&&u.observe(s,{attributes:!1,childList:!0,subtree:!1})}))]}}))}))},e.prototype.mount=function(e){return(0,a.mG)(this,void 0,void 0,(function(){var t=this;return(0,a.Jh)(this,(function(n){return this.unmount(),[2,new Promise((function(n,a){var r={showCreditCard:"card"===e||"all"===e,showBankAccount:"bank"===e||"all"===e},i=document.createElement("button");i.classList.add("AcceptUI"),i.setAttribute("style","display: none;"),i.setAttribute("type","button"),i.setAttribute("data-billingAddressOptions",'{"show":false,"required":false}'),i.setAttribute("data-apiLoginID",t.loginId),i.setAttribute("data-clientKey",t.clientKey),i.setAttribute("data-acceptUIFormBtnTxt","Submit"),i.setAttribute("data-acceptUIFormHeaderTxt","Card Information"),i.setAttribute("data-paymentOptions",JSON.stringify(r)),i.setAttribute("data-responseHandler","peachpayAuthnetResponseHandler"),i.textContent="Pay",t.$button=i;var o=document.createElement("script");o.type="text/javascript",o.src=t.scriptSrc,o.classList.add("pp-authnet-accept-script"),o.onload=function(){n()},o.onerror=function(){a(new Error("Failed to load tokenization script."))},t.$script=o,document.body.appendChild(i),document.body.appendChild(o)}))]}))}))},e.prototype.unmount=function(){var e,t;null===(e=this.$script)||void 0===e||e.remove(),null===(t=this.$button)||void 0===t||t.remove(),(0,p.HD)("#AcceptUIBackground,#AcceptUIContainer",(function(e){e.remove()}))},e.isTokenizing=!1,e}();function k(e){var t=this,n=r.L0.metadata("peachpay_authnet_gateways","accept_src"),h=r.L0.metadata("peachpay_authnet_gateways","public_client_key"),f=r.L0.metadata("peachpay_authnet_gateways","login_id");if(f&&h&&n){var k=new w({loginId:f,clientKey:h,acceptSrc:n}),A=function(){var e,t,n={};if(r.L0.enabled("peachpay_authnet_card_gateway")){var o=function(){var e,t;return{config:{name:null!==(e=r.L0.metadata("peachpay_authnet_card_gateway","title"))&&void 0!==e?e:(0,s.M)("Card"),slug:"card",gateway:"peachpay_authnet_card",description:"".concat((0,s.M)("After clicking <b>Pay</b>, a window will appear where you can enter your card information.")),reusable:!1,assets:{title:{src:d},badge:{src:u}},defaultCurrency:r.L0.metadata("peachpay_authnet_card_gateway","default_currency"),currencies:null!==(t=r.L0.metadata("peachpay_authnet_card_gateway","supported_currencies"))&&void 0!==t?t:["ALL"]}}}();n.card=o}if(r.L0.enabled("peachpay_authnet_echeck_gateway")){var c=function(){var e,t;return{config:{name:null!==(e=r.L0.metadata("peachpay_authnet_echeck_gateway","title"))&&void 0!==e?e:(0,s.M)("US bank account"),slug:"us_bank_account",gateway:"peachpay_authnet_echeck",description:"".concat((0,s.M)("After clicking <b>Pay</b>, a window will appear where you can enter your card information.")),reusable:!1,assets:{title:{src:_},badge:{src:_}},defaultCurrency:r.L0.metadata("peachpay_authnet_echeck_gateway","default_currency"),currencies:null!==(t=r.L0.metadata("peachpay_authnet_echeck_gateway","supported_currencies"))&&void 0!==t?t:["ALL"]}}}();n.bank=c}var p={methods:{}};try{for(var h=(0,a.XA)(Object.entries(n)),f=h.next();!f.done;f=h.next()){var y=(0,a.CR)(f.value,2),v=y[0],m=y[1];p.methods[v]=m.config}}catch(t){e={error:t}}finally{try{f&&!f.done&&(t=h.return)&&t.call(h)}finally{if(e)throw e.error}}return i.h.dispatch((0,l.DK)({authnet:p})),n}();y(),(0,p.HD)(".authnet-btn",(function(n){n.addEventListener("click",(function(){return(0,a.mG)(t,void 0,void 0,(function(){var t,n,s,u,d,p,h,f,y,_,w;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return i.h.dispatch((0,r.N5)()),(t=A[l.hv.selectedProviderMethod()])&&"authnet"===l.hv.selectedProvider()?(n=l.hv.selectedProviderMethod(),[4,k.tokenize(n)]):[2];case 1:return s=a.sent(),u=s.token,d=s.error,p=s.cancel,[4,e.startTransaction(t.config.gateway,t.config.slug)];case 2:return(h=a.sent())?p?(i.h.dispatch((0,r.tv)()),[2]):(null!=d?d:!u)?((0,c.j1)(null!==(w=null==d?void 0:d.map((function(e){return"".concat(e.code,": ").concat(e.message)})).join("\n"))&&void 0!==w?w:"An unknown error occured while tokenizing the payment method."),i.h.dispatch((0,r.tv)()),[2]):[4,e.placeOrder(h,{peachpay_session_id:v.Z5.sessionId(),peachpay_transaction_id:h.getId(),peachpay_authnet_data_descriptor:u.descriptor,peachpay_authnet_data_value:u.value})]:(i.h.dispatch((0,r.tv)()),[2]);case 3:return"failure"!==(f=a.sent()).result?[3,5]:((0,c.j1)(f.message),[4,null==h?void 0:h.complete()]);case 4:return a.sent(),i.h.dispatch((0,r.tv)()),[2];case 5:i.h.dispatch((0,g.ud)({provider:"authnet",method:"card"})),a.label=6;case 6:return a.trys.push([6,8,,10]),[4,(0,b.ll)()];case 7:return a.sent(),[3,10];case 8:return y=a.sent(),console.error(y),[4,h.complete({note:"Failed to update customer in browser :: ".concat((0,o.H)(y))})];case 9:return a.sent(),[3,10];case 10:return(0,m.c)(),_=e.getOrderRedirect(f),window.top?[4,null==h?void 0:h.complete()]:[3,12];case 11:a.sent(),window.top.location=_,a.label=12;case 12:return[2]}}))}))}))}))}}},8883:(e,t,n)=>{e.exports=n.p+"img/d2a66f3e82ab3efab425-card.svg"},9402:(e,t,n)=>{e.exports=n.p+"img/e7542fee9125d1af4d23-bank.svg"},5792:(e,t,n)=>{e.exports=n.p+"img/b2c8b12eb49165de87d5-credit-card-regular.svg"}}]);