"use strict";(self.webpackChunkpeachpay_for_woocommerce=self.webpackChunkpeachpay_for_woocommerce||[]).push([[26],{5026:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x,initPoyntPaymentProvider:()=>x});var i=n(655),a=n(9545),r=n(2121),o=n(9276),s=n(7418),c=n(9536),d=n(7462),l=n(7629),p=n(9970),u=n(8401),h=n(7059),y=n(3658),f=n(6204),v=n(6673),m=n(1212),b=n(4071);function g(){h.h.subscribe((function(){!function(e,t,n){"poynt"===e&&n>0?(0,a.HD)(".poynt-btn-container",(function(e){e.classList.remove("hide")})):(0,a.HD)(".poynt-btn-container",(function(e){e.classList.add("hide")}));"poynt"===e&&"loading"!==t&&n>0?(0,a.HD)(".poynt-btn",(function(e){e.classList.remove("hide")})):(0,a.HD)(".poynt-btn",(function(e){e.classList.add("hide")}))}(l.hv.selectedProvider(),d.qA.modalUI.loadingMode(),v.z9.total()),function(e,t){if("poynt"!==e)return;"finished"===t?(0,a.HD)(".poynt-btn",(function(e){e.disabled=!1})):(0,a.HD)(".poynt-btn",(function(e){e.disabled=!0}));"loading"===t?(0,a.HD)(".pp-btn-spinner-container",(function(e){e.classList.remove("hide")})):(0,a.HD)(".pp-btn-spinner-container ",(function(e){e.classList.add("hide")}));"processing"===t?((0,a.HD)(".poynt-btn > .button-text",(function(e){e.innerHTML=(0,b.M)("Processing")})),(0,a.HD)(".modal-lock-icon",(function(e){e.classList.add("hide")})),(0,a.HD)(".poynt-btn-spinner",(function(e){e.classList.remove("hide")}))):((0,a.HD)(".poynt-btn > .button-text",(function(e){e.innerHTML="".concat((0,b.M)("Pay")," ").concat((0,m.o)(v.AQ.total()))})),(0,a.HD)(".poynt-btn-spinner",(function(e){e.classList.add("hide")})))}(l.hv.selectedProvider(),d.qA.modalUI.loadingMode())}))}var w=n(5792),_=function(){function e(e){this.businessId=e.businessId,this.applicationId=e.applicationId,this.$cardElement=new TokenizeJs(this.businessId,this.applicationId)}return e.prototype.mount=function(e,t){this.$cardElement.mount(e,document,t)},e.prototype.tokenize=function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t=this;return(0,i.Jh)(this,(function(n){return[2,new Promise((function(n){t.$cardElement.on("nonce",(function(e){e.data.nonce&&n({nonce:e.data.nonce})})),t.$cardElement.on("error",(function(e){var t,i,a,r,o;n({error:null!==(o=null!==(i=null===(t=e.data)||void 0===t?void 0:t.message)&&void 0!==i?i:null===(r=null===(a=e.data)||void 0===a?void 0:a.error)||void 0===r?void 0:r.message)&&void 0!==o?o:"Something went wrong. Please try again."})})),t.$cardElement.getNonce(e)}))]}))}))},e}();function x(e){return(0,i.mG)(this,void 0,void 0,(function(){var t,n,v,m;return(0,i.Jh)(this,(function(x){switch(x.label){case 0:return d.L0.enabled("peachpay_poynt_gateways")?(t=d.L0.metadata("peachpay_poynt_gateways","poynt_src"),n=d.L0.metadata("peachpay_poynt_gateways","business_id"),v=d.L0.metadata("peachpay_poynt_gateways","application_id"),n&&v&&t?(m={businessId:n,applicationId:v},[4,(0,a.ve)(t,null,(function(){var t=function(){var e,t,n={};if(d.L0.enabled("peachpay_poynt_card_gateway")){var r=function(){var e,t={name:(0,b.M)("Card"),slug:"card",gateway:"peachpay_poynt_card",description:"",reusable:!1,assets:{title:{src:w},badge:{src:w}},defaultCurrency:d.L0.metadata("peachpay_poynt_card_gateway","default_currency"),currencies:null!==(e=d.L0.metadata("peachpay_poynt_card_gateway","supported_currencies"))&&void 0!==e?e:["ALL"]},n=null,r=null;return{config:t,init:function(e){var t={iFrame:{border:"0px",borderRadius:"0px",boxShadow:"none",height:"84px",width:"-webkit-fill-available"}},i=(0,a.MW)('#pp-pms-existing div.pp-pm-saved-option[data-provider="poynt"][data-method="card"][data-index=""]'),o=(0,a.MW)('#pp-pms-new div.pp-pm-saved-option[data-provider="poynt"][data-method="card"][data-index=""]');i&&o&&(i.setAttribute("id","pp-poynt-existing"),i.style.padding="0px",i.style.border="0px",i.style.width="-webkit-fill-available",(r=new _(e)).mount("pp-poynt-existing",t),o.setAttribute("id","pp-poynt-new"),o.style.padding="0px",o.style.border="0px",o.style.width="-webkit-fill-available",(n=new _(e)).mount("pp-poynt-new",t))},tokenize:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(i){return(t=d.qA.customer.existing()?r:n)?[2,t.tokenize(e)]:[2,{error:"Poynt Card element not found while attempting to tokenize card."}]}))}))}}}();n.card=r}var o={methods:{}};try{for(var s=(0,i.XA)(Object.entries(n)),c=s.next();!c.done;c=s.next()){var p=(0,i.CR)(c.value,2),u=p[0],y=p[1];o.methods[u]=y.config}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return h.h.dispatch((0,l.DK)({poynt:o})),n}();!function(e,t,n){var v,m;try{for(var b=(0,i.XA)(Object.entries(e)),g=b.next();!g.done;g=b.next()){var w=(0,i.CR)(g.value,2),_=(w[0],w[1]);_.init&&_.init(n)}}catch(e){v={error:e}}finally{try{g&&!g.done&&(m=b.return)&&m.call(b)}finally{if(v)throw v.error}}var x=function(n){if((0,o.N6)()){var v=n.target;if(null==v?void 0:v.closest("button")){var m=e[l.hv.selectedProviderMethod()];if(m&&"poynt"===l.hv.selectedProvider())return function(e,t){return(0,i.mG)(this,void 0,void 0,(function(){var n,o,v,m,b,g,w,_;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(0,a.HD)(".pp-pm-error-text",(function(e){e.remove()})),h.h.dispatch((0,d.N5)()),n=function(){var e={};p.gx.billing.email()&&(e.emailAddress=p.gx.billing.email());p.gx.billing.firstName()&&(e.firstName=p.gx.billing.firstName());p.gx.billing.lastName()&&(e.lastName=p.gx.billing.lastName());p.gx.billing.address1()&&(e.line1=p.gx.billing.address1());p.gx.billing.postal()&&(e.zipCode=p.gx.billing.postal());return e}(),[4,e.tokenize(n)];case 1:return o=i.sent(),v=o.nonce,m=o.error,[4,t.startTransaction(e.config.gateway)];case 2:return(b=i.sent())?(null!=m?m:!v)?("returning"===d.qA.modalUI.page()&&setTimeout((function(){(0,c.yH)("payment")}),500),[4,b.complete({paymentStatus:"creationfailed",orderStatus:"unperformed",note:null!=m?m:"An unknown error occured while retrieving the nonce."})]):[3,4]:(h.h.dispatch((0,d.tv)()),[2]);case 3:return i.sent(),(0,y.j1)(null!=m?m:"An unknown error occured while tokenizing the payment method."),h.h.dispatch((0,d.tv)()),[2];case 4:return[4,t.placeOrder(b,{peachpay_session_id:u.Z5.sessionId(),peachpay_transaction_id:b.getId(),peachpay_poynt_nonce:v})];case 5:return"failure"!==(g=i.sent()).result?[3,7]:[4,null==b?void 0:b.complete()];case 6:return i.sent(),h.h.dispatch((0,d.tv)()),[2];case 7:h.h.dispatch((0,p.ud)({provider:l.hv.selectedProvider(),method:l.hv.selectedProviderMethod()})),i.label=8;case 8:return i.trys.push([8,10,,12]),[4,(0,s.ll)()];case 9:return i.sent(),[3,12];case 10:return w=i.sent(),console.error(w),[4,b.complete({note:"Failed to update customer in browser :: ".concat((0,r.H)(w))})];case 11:return i.sent(),[3,12];case 12:return(0,f.c)(),_=t.getOrderRedirect(g),window.top?[4,b.complete()]:[3,14];case 13:i.sent(),window.top.location=_,i.label=14;case 14:return[2]}}))}))}(m,t)}}};(0,a.HD)(".poynt-btn",(function(e){e.addEventListener("click",(function(e){return x(e)}))}))}(t,e,m),g()}))]):[2]):[2];case 1:return x.sent(),[2]}}))}))}},5792:(e,t,n)=>{e.exports=n.p+"img/b2c8b12eb49165de87d5-credit-card-regular.svg"}}]);